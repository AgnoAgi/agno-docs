---
title: Storage
---

Agents come with built-in memory but it only lasts while the session is active. To continue conversations across sessions, we store Agent runs in a database like PostgreSQL.

Storage is a necessary component when building user facing AI products as any production application will require users to be able to "continue" their conversation with the AI.

The general syntax for adding storage to an Agent looks like:

```python storage.py
from phi.agent import Agent
from phi.model.openai import OpenAIChat
from phi.storage.agent.postgres import PgAgentStorage

agent = Agent(
    model=OpenAIChat(id="gpt-4o"),
    storage=PgAgentStorage(table_name="agent_sessions", db_url="postgresql+psycopg://ai:ai@localhost:5532/ai"),
    system_prompt="Your name is optimus",
    add_history_to_messages=True,
    markdown=True,
    # debug_mode=True,
)
agent.print_response("Share a 1 sentence horror story", stream=True)
agent.print_response("Share a 2 sentence horror story", stream=True)
```

## Params

<ResponseField name="table_name" type="str">
  The name of the table to store agent runs in.
</ResponseField>
<ResponseField name="schema" type="str" default="ai">
  The schema to store the table in.
</ResponseField>
<ResponseField name="db_url" type="str">
  The database URL to connect to.
</ResponseField>
<ResponseField name="db_engine" type="Engine">
  The database engine to use.
</ResponseField>

## Example

<Steps>
  <Step title="Create a virtual environment">
    Open the `Terminal` and create a python virtual environment.

    <CodeGroup>

    ```bash Mac
    python3 -m venv ~/.venvs/aienv
    source ~/.venvs/aienv/bin/activate
    ```

    ```bash Windows
    python3 -m venv aienv
    aienv/scripts/activate
    ```

    </CodeGroup>

  </Step>
  <Step title="Install libraries">
    Install libraries using pip

    <CodeGroup>

    ```bash Mac
    pip install -U phidata openai pgvector pypdf "psycopg[binary]" sqlalchemy
    ```

    ```bash Windows
    pip install -U phidata openai pgvector pypdf "psycopg[binary]" sqlalchemy
    ```

    </CodeGroup>

  </Step>
  <Step title="Run PgVector">

    Install [docker desktop](https://docs.docker.com/desktop/install/mac-install/) and run **PgVector** on port **5532** using:

    ```bash
    docker run -d \
      -e POSTGRES_DB=ai \
      -e POSTGRES_USER=ai \
      -e POSTGRES_PASSWORD=ai \
      -e PGDATA=/var/lib/postgresql/data/pgdata \
      -v pgvolume:/var/lib/postgresql/data \
      -p 5532:5432 \
      --name pgvector \
      phidata/pgvector:16
    ```

  </Step>
  <Step title="Create an Agent with Storage">
    Create a file `pdf_agent.py` with the following contents

    ```python pdf_agent.py
    import typer
    from typing import Optional, List
    from phi.agent import Agent
    from phi.storage.agent.postgres import PgAgentStorage
    from phi.knowledge.pdf import PDFUrlKnowledgeBase
    from phi.vectordb.pgvector import PgVector, SearchType

    db_url = "postgresql+psycopg://ai:ai@localhost:5532/ai"
    knowledge_base = PDFUrlKnowledgeBase(
        urls=["https://phi-public.s3.amazonaws.com/recipes/ThaiRecipes.pdf"],
        vector_db=PgVector(table_name="recipes", db_url=db_url, search_type=SearchType.hybrid),
    )
    # Load the knowledge base: Comment out after first run
    knowledge_base.load(upsert=True)

    storage = PgAgentStorage(table_name="pdf_agent", db_url=db_url)


    def pdf_agent(new: bool = False, user: str = "user"):
        session_id: Optional[str] = None

        if not new:
            existing_sessions: List[str] = storage.get_all_session_ids(user)
            if len(existing_sessions) > 0:
                session_id = existing_sessions[0]

        agent = Agent(
            session_id=session_id,
            user_id=user,
            knowledge=knowledge_base,
            storage=storage,
            # Show tool calls in the response
            show_tool_calls=True,
            # Enable the agent to read the chat history
            read_chat_history=True,
        )
        if session_id is None:
            session_id = agent.session_id
            print(f"Started Session: {session_id}\n")
        else:
            print(f"Continuing Session: {session_id}\n")

        # Runs the agent as a cli app
        agent.cli_app(markdown=True)


    if __name__ == "__main__":
        typer.run(pdf_agent)

    ```
  </Step>
  <Step title="Run the agent">
    Run the `pdf_agent.py` file

    ```bash
    python pdf_agent.py
    ```

    Now the agent continues across sessions. Ask a question:

    ```
    How do I make pad thai?
    ```

    Then message `bye` to exit, start the app again and ask:

    ```
    What was my last message?
    ```

  </Step>
  <Step title="Start a new run">
    Run the `pdf_agent.py` file with the `--new` flag to start a new run.

    ```bash
    python pdf_agent.py --new
    ```

  </Step>
</Steps>
